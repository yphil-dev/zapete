#!/usr/bin/make -f

%:
	dh $@

override_dh_auto_install:
	# Install the application (exclude debian directory and build artifacts)
	mkdir -p $(CURDIR)/debian/zapete/usr/lib/zapete
	cp -r src/ buttons-defaults.json package.json $(CURDIR)/debian/zapete/usr/lib/zapete/
	# Ensure QR code placeholder exists for package
	touch $(CURDIR)/debian/zapete/usr/lib/zapete/img/zapete-qrcode.png
	# Copy node_modules separately to ensure it gets included
	cp -r node_modules $(CURDIR)/debian/zapete/usr/lib/zapete/ || echo "Warning: node_modules copy failed"

	# Create startup script
	install -m 755 $(CURDIR)/debian/launch.sh $(CURDIR)/debian/zapete/usr/lib/zapete/

	# Create symlink for binary
	mkdir -p $(CURDIR)/debian/zapete/usr/bin
	ln -s /usr/lib/zapete/launch.sh $(CURDIR)/debian/zapete/usr/bin/zapete

	# Create desktop file
	mkdir -p $(CURDIR)/debian/zapete/usr/share/applications
	install -m 644 $(CURDIR)/debian/zapete.desktop $(CURDIR)/debian/zapete/usr/share/applications/

override_dh_auto_build:
	# Install npm dependencies
	cd $(CURDIR) && npm install --production

override_dh_auto_clean:
	# Clean npm dependencies
	rm -rf node_modules package-lock.json
